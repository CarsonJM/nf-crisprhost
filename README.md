# nf-crisprhost
A Nextflow wrapper for aligning CRISPR spacers to phage sequences to identify phage-host pairs.

### Overview
This wrapper performs the following steps:
1. Downloads the `--spacer_fasta` FastA file (if necessary).
2. Splits the `--spacer_fasta` into chunks of size `--chunk_size` for parallelization.
3. Creates a database from the `--virus_fasta` file for alignment.
4. Aligns each spacer chunk to the `--vius_fasta` database.
5. Combines outputs from each chunk into the `--output` TSV file.

### Quick Start
In addition to automated downloads and cleanup (limiting disk requirements), this wrapper also makes setup very easy.

First, install Conda/Mamba/Micromamba/Pixi

*Example Micromamba installation*
```
"${SHELL}" <(curl -L micro.mamba.pm/install.sh)
```

Then create a Nextflow environment
```
micromamba create -n nextflow -c conda-forge -c bioconda nextflow -y
```

Activate the Nextflow environemtn
```
micromamba activate nextflow
```

Then just run the pipeline!
```
nextflow run CarsonJM/nf-crisprhost -profile test,<docker/singularity/conda/mamba>
```

### Usage
The only arguments for this tool are:

`--spacer_fasta`: Path (or URL) to a FastA file of CRISPR spacers.

`--virus_fasta`: Path (or URL) to a FastA file of viral genomes.

`--chunk_size`: Number (Integer) of spacer sequences contained in each chunk (default: 10,000,000)

`--output`: Path to output TSV file containing information on all spacer-virus hits.

### Output
The only output of this wrapper is the common k-mers table generated by PHIST
```tsv
Spacer id	Target id	Start	End	Strand	N mismatches	CIGAR	MD	spacer	protospacer	upstream	downstream	flags
Sp_cl_000389597991	NC_067194.1_MAG:_Carjivirus_communis,_complete_genome	580	615	+	1	36M	1G34	AATTCTGCGCAAGTGGAAACCATTGATGATGTTGTT	.G..................................	AGATAACCAA	AGACGCATCT	
Sp_cl_000214877100	NC_067194.1_MAG:_Carjivirus_communis,_complete_genome	12711	12740	+	0	30M	30	TAGAATGGACGAAGATAAAGAAGTTAAAGT	..............................	CGCTCTTTGA	TAATGATACT	
Sp_cl_000002593488	NC_067194.1_MAG:_Carjivirus_communis,_complete_genome	46218	46247	-	0	30M	30	TAAACTCTCCAGCTTTATTCATAACACTAC	..............................	GTTACTTTTA	TTAATAAACG	

```

### Credits
This wrapper was made by @CarsonJM. However, primary credit of course goes to the SpacerExtractor developers (https://code.jgi.doe.gov/SRoux/spacerextractor), and their work should be cited if this wrapper is used (https://doi.org/10.1101/2025.06.12.659409)